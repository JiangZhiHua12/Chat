(function(){"use strict";var e={2083:function(e,t,n){var s=n(9242),o=n(3396);function r(e,t,n,s,r,a){const i=(0,o.up)("choose-user"),l=(0,o.up)("user-list"),u=(0,o.up)("chat-com");return(0,o.wg)(),(0,o.iD)(o.HY,null,[r.me?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(i,{key:0,userlist:r.userList},null,8,["userlist"])),(0,o.Wm)(l,{islogin:r.islogin,user:r.user,clickEvent:a.clickEvent,unreaduser:r.unreaduser},null,8,["islogin","user","clickEvent","unreaduser"]),r.ischat?((0,o.wg)(),(0,o.j4)(u,{key:1,touser:r.touser,backEvent:a.backEvent,newMsg:r.newMsg},null,8,["touser","backEvent","newMsg"])):(0,o.kq)("",!0)],64)}var a=n(7139);const i=e=>((0,o.dD)("data-v-3f4229f6"),e=e(),(0,o.Cn)(),e),l={class:"chooseUser"},u=i((()=>(0,o._)("div",{class:"nav"},"请选择聊天的用户",-1))),c={class:"li"},h=["onClick"],m=["src"];function d(e,t,n,s,r,i){return(0,o.wg)(),(0,o.iD)("div",l,[u,(0,o._)("div",c,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.userlist,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{class:"item",key:t,onClick:t=>i.chooseEvent(e)},[(0,o._)("img",{src:e.headerimg},null,8,m),(0,o._)("span",null,(0,a.zw)(e.username),1)],8,h)))),128))])])}var f=n(4700),g=f.ZP.connect("http://localhost:3000"),v=g,p={name:"chooseUser",props:["userlist"],methods:{chooseEvent:function(e){this.$parent.me=e,localStorage.chatme=JSON.stringify(e),v.emit("login",e)}}},S=n(89);const w=(0,S.Z)(p,[["render",d],["__scopeId","data-v-3f4229f6"]]);var b=w;const _=e=>((0,o.dD)("data-v-69529431"),e=e(),(0,o.Cn)(),e),k={class:"userlist"},y={class:"nav"},O=["src"],E=_((()=>(0,o._)("div",null,"消 息",-1))),D=_((()=>(0,o._)("div",{class:"juzho"},null,-1))),M=["onClick"],C={class:"item"},j=["src"];function $(e,t,n,s,r,i){return(0,o.wg)(),(0,o.iD)("div",k,[(0,o._)("div",y,[(0,o._)("div",{class:(0,a.C_)({disonline:!n.islogin,online:n.islogin})},[null!=e.$parent.me?((0,o.wg)(),(0,o.iD)("img",{key:0,src:e.$parent.me.headerimg},null,8,O)):(0,o.kq)("",!0)],2),E,D]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.friends,((s,r)=>((0,o.wg)(),(0,o.iD)("div",{class:"list",onClick:e=>n.clickEvent(s),key:r,onMousemove:t[0]||(t[0]=(...t)=>e.moveEvent&&e.moveEvent(...t))},[(0,o._)("div",C,[(0,o._)("div",{class:(0,a.C_)({disline:null===s.isonline,line:!0===s.isonline,unread:-1!=this.unreaduser.indexOf(s.username)})},[(0,o._)("img",{src:s.headerimg},null,8,j)],2),(0,o._)("div",null,(0,a.zw)(s.username),1)])],40,M)))),128))])}var x={name:"userLIst",props:["islogin","user","clickEvent","unreaduser"],computed:{friends:function(){return this.user.filter((e=>e.username!==this.$parent.me.username))}},methods:{}};const J=(0,S.Z)(x,[["render",$],["__scopeId","data-v-69529431"]]);var N=J;const H=e=>((0,o.dD)("data-v-88b955c6"),e=e(),(0,o.Cn)(),e),L={class:"chatcom"},T={class:"nav"},U={class:"username"},z=H((()=>(0,o._)("div",null,null,-1))),P={class:"chatlist",ref:"chatbox"},Z=["src"],B={class:"content"},I={class:"inputCom"};function K(e,t,n,r,i,l){return(0,o.wg)(),(0,o.iD)("div",L,[(0,o._)("div",T,[(0,o._)("i",{onClick:t[0]||(t[0]=(...e)=>n.backEvent&&n.backEvent(...e)),class:"fa fa-angle-left","aria-hidden":"true"}),(0,o._)("div",U,[(0,o._)("label",null,(0,a.zw)(n.touser.username),1)]),z]),(0,o._)("div",P,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.chatlist,((t,n)=>((0,o.wg)(),(0,o.iD)("div",{key:n,class:(0,a.C_)({itemself:e.$parent.me.username===t.from.username,item:e.$parent.me.username!==t.from.username})},[(0,o._)("div",null,[(0,o._)("img",{src:t.from.headerimg},null,8,Z)]),(0,o._)("div",B,(0,a.zw)(t.content),1)],2)))),128))],512),(0,o._)("div",I,[(0,o.wy)((0,o._)("input",{onKeydown:t[1]||(t[1]=(0,s.D2)(((...e)=>l.sendMsgEvent&&l.sendMsgEvent(...e)),["enter"])),"onUpdate:modelValue":t[2]||(t[2]=e=>i.inputData=e)},null,544),[[s.nr,i.inputData]]),(0,o._)("button",{onClick:t[3]||(t[3]=(...e)=>l.sendMsgEvent&&l.sendMsgEvent(...e))},"发送")])])}var Y={name:"chatCom",props:["touser","backEvent","newMsg"],data(){return{chatlist:[],inputData:""}},methods:{sendMsgEvent:function(){var e={from:this.$parent.me,to:this.touser,content:this.inputData,time:(new Date).getDate()};v.emit("sendMsg",e),this.chatlist.push(e),this.savelocalStorage(),this.inputData="",this.scrollBottom()},savelocalStorage(){var e="chat-from-"+this.$parent.me.username+"-to-"+this.touser.username;localStorage[e]=JSON.stringify(this.chatlist)},getlocalStorage(){var e="chat-from-"+this.$parent.me.username+"-to-"+this.touser.username;localStorage[e]=localStorage[e]?localStorage[e]:"[]",this.chatlist=JSON.parse(localStorage[e])},scrollBottom(){var e=this.$refs.chatbox;e.scrollTop=e.scrollHeight-e.clientHeight}},beforeMount(){this.getlocalStorage(),v.emit("readMsg",{self:this.$parent.me.username,to:this.touser.username})},mounted(){this.scrollBottom()},updated(){this.scrollBottom()},watch:{newMsg:function(e){this.chatlist.push(e),this.savelocalStorage()}}};const q=(0,S.Z)(Y,[["render",K],["__scopeId","data-v-88b955c6"]]);var A=q,F=n(6265),R=n.n(F),V={name:"App",components:{chooseUser:b,userList:N,chatCom:A},data(){return{userList:[],islogin:!1,me:null,user:[],touser:null,ischat:!1,unreaduser:[],newMsg:null}},async beforeMount(){var e=await R().get("/userlist");this.userList=e.data,console.log(e.data)},mounted(){v.on("connect",(function(){console.log("连接成功")})),v.on("login",(e=>{"ok"===e.status&&(this.islogin=!0,v.emit("userlist"))})),v.on("loginout",(e=>{console.log(e),v.disconnect(),this.islogin=!1})),v.on("disconnect",(function(){console.log("断开连接")})),v.on("userlist",(e=>{this.user=e})),v.on("user",(e=>{this.user=e})),v.on("Unread",(e=>{e.forEach((e=>{this.unreaduser.push(e.from);var t="chat-from-"+this.me.username+"-to-"+e.from;localStorage[t]=localStorage[t]?localStorage[t]:"[]";var n=JSON.parse(localStorage[t]);e.from=this.userObj[e.from],e.to=this.userObj[e.to],n.push(e),localStorage[t]=JSON.stringify(n),console.log(this.touser)}))})),v.on("reception",(e=>{if(console.log(e),1==this.ischat&&e.from.username==this.touser.username)this.newMsg=e;else if("true"==e.to.isgroup){var t="chat-from-"+this.me.username+"-to-"+e.to.username;localStorage[t]=localStorage[t]?localStorage[t]:"[]";var n=JSON.parse(localStorage[t]);n.push(e),localStorage[t]=JSON.stringify(n),this.unreaduser.push(e.to.username)}else{var s="chat-from-"+this.me.username+"-to-"+e.from.username;localStorage[s]=localStorage[s]?localStorage[s]:"[]";var o=JSON.parse(localStorage[s]);o.push(e),localStorage[s]=JSON.stringify(o),this.unreaduser.push(e.from.username)}}))},methods:{clickEvent:function(e){this.touser=e,console.log(this.touser.username),this.ischat=!0;var t=this.unreaduser.indexOf(e.username);this.unreaduser.splice(t,1)},backEvent:function(){this.ischat=!1}},computed:{userObj:function(){var e={};return this.user.forEach((t=>{e[t.username]=t})),e}}};const W=(0,S.Z)(V,[["render",r]]);var G=W;R().defaults.baseURL="/api",R().defaults.headers.post["Content-Type"]="application//json",(0,s.ri)(G).mount("#app")}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(t,s,o,r){if(!s){var a=1/0;for(c=0;c<e.length;c++){s=e[c][0],o=e[c][1],r=e[c][2];for(var i=!0,l=0;l<s.length;l++)(!1&r||a>=r)&&Object.keys(n.O).every((function(e){return n.O[e](s[l])}))?s.splice(l--,1):(i=!1,r<a&&(a=r));if(i){e.splice(c--,1);var u=o();void 0!==u&&(t=u)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[s,o,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,r,a=s[0],i=s[1],l=s[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(l)var c=l(n)}for(t&&t(s);u<a.length;u++)r=a[u],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(c)},s=self["webpackChunkwxcaht"]=self["webpackChunkwxcaht"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[998],(function(){return n(2083)}));s=n.O(s)})();
//# sourceMappingURL=app.8029fb10.js.map